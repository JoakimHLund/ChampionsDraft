<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="player.css">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Information</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            vertical-align: middle; /* Center content vertically */
        }
        th {
            background-color: #f2f2f2;
            text-align: left;
        }
        img {
            height: 50px;
            vertical-align: middle;
        }
        .person-icon {
            width: 20px;
            height: 20px;
            margin-left: 2px;
            vertical-align: middle;
            color: green; /* Set the desired color here */
        }

        /* Optional: Adjust the cell to accommodate the icons */
        td.logo-cell {
            white-space: nowrap;
        }

        /* Blue for Champions Trophy */
        .trophy-icon.champions {
            filter: brightness(0) saturate(100%) invert(38%) sepia(87%) saturate(672%) hue-rotate(178deg) brightness(92%) contrast(88%);
        }

        /* Orange for Europa Trophy */
        .trophy-icon.europa {
            filter: brightness(0) saturate(100%) invert(49%) sepia(92%) saturate(3182%) hue-rotate(1deg) brightness(101%) contrast(102%);
        }

        /* Green for Conference Trophy */
        .trophy-icon.conference {
            filter: brightness(0) saturate(100%) invert(65%) sepia(54%) saturate(571%) hue-rotate(83deg) brightness(95%) contrast(91%);
        }
    </style>
</head>
<body>
    <h1 id="player-name"></h1>

    <h2>
        <img src="img/icons/championstrophy.png" alt="Champions Trophy" class="trophy-icon champions">
        Champions League
    </h2>
    <table id="champions-league-table">
        <thead>
            <tr>
                <th>Logo</th>
                <th>Team</th>
                <th>Played Games</th>
                <th>Points</th>
                <th>Bonus Points</th>
                <th>Multiplier</th>
                <th>Total Score</th>
            </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
            <tr>
                <td colspan="6">Total</td>
                <td id="champions-league-table-total"></td>
            </tr>
        </tfoot>
    </table>

    <h2>
        <img src="img/icons/europatrophy.png" alt="Europa Trophy" class="trophy-icon europa">
        Europa League
    </h2>
    <table id="europa-league-table">
        <thead>
            <tr>
                <th>Logo</th>
                <th>Team</th>
                <th>Played Games</th>
                <th>Points</th>
                <th>Bonus Points</th>
                <th>Multiplier</th>
                <th>Total Score</th>
            </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
            <tr>
                <td colspan="6">Total</td>
                <td id="europa-league-table-total"></td>
            </tr>
        </tfoot>
    </table>

    <h2>
        <img src="img/icons/conferencetrophy.png" alt="Conference Trophy" class="trophy-icon conference">
        Conference League
    </h2>
    <table id="conference-league-table">
        <thead>
            <tr>
                <th>Logo</th>
                <th>Team</th>
                <th>Played Games</th>
                <th>Points</th>
                <th>Bonus Points</th>
                <th>Multiplier</th>
                <th>Total Score</th>
            </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
            <tr>
                <td colspan="6">Total</td>
                <td id="conference-league-table-total"></td>
            </tr>
        </tfoot>
    </table>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script>
  // Initialize Firebase (use your existing configuration)
  const firebaseConfig = {
    apiKey: "AIzaSyCtkvwfwgZmCY7Ho1Uh1Itm8jDXhuff7_g",
    authDomain: "championsdraft25.firebaseapp.com",
    projectId: "championsdraft25",
    storageBucket: "championsdraft25.firebasestorage.app",
    messagingSenderId: "194206448130",
    appId: "1:194206448130:web:58358b48e25006f511c51b"
  };

  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Get player name from URL parameters
  const urlParams = new URLSearchParams(window.location.search);
  const playerName = decodeURIComponent(urlParams.get('playername') || '');

  // Set heading
  document.getElementById('player-name').textContent = playerName || 'Player';

  async function getPlayerData() {
    const snap = await db.collection('players').where('Name', '==', playerName).limit(1).get();
    if (snap.empty) {
      alert('Player not found');
      return;
    }
    const player = snap.docs[0].data();

    // Use the new collections
    await populateTable(player.selectedChampions || [], 'champions-league-table', 'CLTeams');
    await populateTable(player.selectedEuropa || [],     'europa-league-table',    'ELTeams');
    await populateTable(player.selectedConference || [], 'conference-league-table', 'ECTeams');
  }

  async function populateTable(selectedTeams, tableId, collectionName) {
    const tbody = document.querySelector(`#${tableId} tbody`);
    tbody.innerHTML = '';
    let totalScore = 0;

    // Helper: fetch team doc by Name field (not by doc id)
    async function getTeamDocByName(name) {
      const q = await db.collection(collectionName).where('Name', '==', name).limit(1).get();
      return q.empty ? null : q.docs[0].data();
    }

    for (const t of (selectedTeams || [])) {
      const selName = (t?.name || '').trim();
      if (!selName) continue;

      const teamData = await getTeamDocByName(selName);
      if (!teamData) {
        console.warn(`Team "${selName}" not found in ${collectionName}`);
        continue;
      }

      const displayName  = teamData.Name || selName;
      const logo         = teamData.logo || '';
      const played       = teamData.gamesplayed ?? '-';                // optional
      const basePoints   = Number(teamData.leaguepoints || 0);    // raw points from matches
      const bonusPoints  = Number(teamData.bonuspoints || 0);     // optional
      const multiplier   = Number(teamData.multiplier ?? 1);
      const storedTotal  = (typeof teamData.totalScore === 'number') ? teamData.totalScore : null;

      // Prefer stored totalScore; else compute fallback
      const totalForTeam = storedTotal ?? ((basePoints + bonusPoints) * multiplier);
      totalScore += totalForTeam;

      const rowHtml = `
        <tr>
          <td class="logo-cell"><img src="img/logos/${logo}" alt="${displayName} logo"></td>
          <td>${displayName}</td>
          <td>${played}</td>
          <td>${basePoints}</td>
          <td>${bonusPoints}</td>
          <td>${multiplier}</td>
          <td>${totalForTeam.toFixed(1)}</td>
        </tr>
      `;
      tbody.insertAdjacentHTML('beforeend', rowHtml);
    }

    const totalEl = document.getElementById(`${tableId}-total`);
    if (totalEl) totalEl.textContent = totalScore.toFixed(1);
  }

  // Kick off
  getPlayerData();
</script>

</body>
</html>